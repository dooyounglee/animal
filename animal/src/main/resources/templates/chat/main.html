<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block th:insert="~{fragments/head::head}"></th:block>
<body class="fix-header card-no-border logo-center">
	<!-- Preloader - style you can find in spinners.css -->
 	<th:block th:insert="~{fragments/head::preloader}"></th:block>
	<!-- End of Preloader - style you can find in spinners.css -->
	
	<!-- Main wrapper -->
	<div id="main-wrapper">
	
		<!-- Topbar header - style you can find in pages.scss -->
	        <header class="topbar">
	        	<th:block th:insert="~{fragments/header::header}"></th:block>
	        </header>
	    <!-- End Topbar header -->
	    
	    <!-- Left-sidebar -->
        <aside class="left-sidebar">
			<th:block th:insert="~{fragments/menu::menu}"></th:block>
        </aside>
        <!-- End of Left-sidebar -->
        
        <!-- Page wrapper  -->
        <div class="page-wrapper">
        
        	<!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                <div class="row page-titles">
                    <div class="col-md-5 col-12 align-self-center">
                        <h3 class="text-themecolor mb-0 mt-0">Q&A</h3>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Home</a></li>
                            <li class="breadcrumb-item active">Q&A</li>
                        </ol>
                    </div>
                    <div class="col-md-7 col-12 align-self-center d-none d-md-block">
                        <div class="d-flex mt-2 justify-content-end">
                            <div class="d-flex mr-3 ml-2">
                                <div class="chart-text mr-2">
                                    <h6 class="mb-0"><small>THIS MONTH</small></h6>
                                    <h4 class="mt-0 text-info">$58,356</h4>
                                </div>
                                <div class="spark-chart">
                                    <div id="monthchart"></div>
                                </div>
                            </div>
                            <div class="d-flex mr-3 ml-2">
                                <div class="chart-text mr-2">
                                    <h6 class="mb-0"><small>LAST MONTH</small></h6>
                                    <h4 class="mt-0 text-primary">$48,356</h4>
                                </div>
                                <div class="spark-chart">
                                    <div id="lastmonthchart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- End Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                <!-- ============================================================== -->
                <!-- Start Page Content -->
                <!-- ============================================================== -->
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-0">
                            <!-- .chat-row -->
                            <div class="chat-main-box">
                                <!-- .chat-left-panel -->
                                <div class="chat-left-aside">
                                    <div class="open-panel"><i class="ti-angle-right"></i></div>
                                    <div class="chat-left-inner">
                                        <div class="form-material">
                                            <input class="form-control p-3" type="text" placeholder="Search Contact">
                                        </div>
                                        <ul class="chatonline style-none ">
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/1.jpg" alt="user-img" class="rounded-circle"> <span>Varun Dhavan <small class="text-success">online</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)" class="active"><img src="/material-pro/assets/images/users/2.jpg" alt="user-img" class="rounded-circle"> <span>Genelia Deshmukh <small class="text-warning">Away</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/3.jpg" alt="user-img" class="rounded-circle"> <span>Ritesh Deshmukh <small class="text-danger">Busy</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/4.jpg" alt="user-img" class="rounded-circle"> <span>Arijit Sinh <small class="text-muted">Offline</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/5.jpg" alt="user-img" class="rounded-circle"> <span>Govinda Star <small class="text-success">online</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/6.jpg" alt="user-img" class="rounded-circle"> <span>John Abraham<small class="text-success">online</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/7.jpg" alt="user-img" class="rounded-circle"> <span>Hritik Roshan<small class="text-success">online</small></span></a>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0)"><img src="/material-pro/assets/images/users/8.jpg" alt="user-img" class="rounded-circle"> <span>Pwandeep rajan <small class="text-success">online</small></span></a>
                                            </li>
                                            <li class="p-3"></li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- .chat-left-panel -->
                                <!-- .chat-right-panel -->
                                <div class="chat-right-aside">
                                    <div class="chat-main-header">
                                        <div class="p-3 border-bottom">
                                            <h3 class="p-2 rounded-title">Chat Message</h3>
                                        </div>
                                    </div>
                                    <div class="chat-rbox">
                                        <ul id="chatArea" class="chat-list m-0 p-4 list-style-none">
                                        </ul>
                                    </div>
                                    <div class="card-body border-top">
                                        <div class="row">
                                            <div class="col-8">
                                                <textarea placeholder="Type your message here" id="chatText" class="form-control b-0"></textarea>
                                            </div>
                                            <div class="col-4 text-right">
                                                <button type="button" id="chatSendBtn" class="btn btn-info btn-circle btn-lg"><i class="fas fa-paper-plane"></i> </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- .chat-right-panel -->
                            </div>
                            <!-- /.chat-row -->
                        </div>
                    </div>
                </div>
                <!-- ============================================================== -->
                <!-- End PAge Content -->
                <!-- ============================================================== -->
            </div>
            <!-- ============================================================== -->
            <!-- End Container fluid  -->
            <!-- ============================================================== -->

			<!-- footer -->
			<footer class="footer m-0 p-0">
				<th:block th:insert="~{fragments/footer::footer}"></th:block>
	        </footer>
			<!--  End of footer -->
	
		</div>
        <!-- End of Page wrapper  -->
        
	</div>
	<!-- End of Main wrapper -->
	<script th:inline="javascript">
		var ws_count = new WebSocket("ws://"+[[${#httpServletRequest.serverName}]]+":[[${#httpServletRequest.serverPort}]]/chat");
		ws_count.onopen=function() {
			console.log("count성공")
		}
		ws_count.onmessage = function(msg) {
        	var str='<li class="mt-4">';
            str+='<div class="chat-content pl-3 d-inline-block">';
            str+='<h5 class="text-muted">Angelina Rhodes</h5>';
            str+='<div class="p-2 rounded bg-light-primary d-inline-block mb-2 text-dark">';
            str+=msg.data
            str+='</div>';
            str+='</div>';
            str+='<div class="chat-time d-inline-block text-left text-muted">10:59 am</div>';
        	str+='</li>';
			$('#chatArea').append(str)
			
			var chatCount=$('#chatArea li').length
        	$('#chatArea').scrollTop(chatCount*100)
        	$('div.slimScrollBar').css('top',chatCount*100)
		}
		ws_count.onclose = function(evt) {
			console.log("count연결 끊김");
		}
		
		$('#chatSendBtn').click(function(){
			var chat=$('#chatText').val()
			ws_count.send($('#chatText').val());
			
			var str='<li class="odd">';
            str+='<div class="chat-content pl-3 d-inline-block text-right">';
            str+='<div class="p-2 rounded bg-light-inverse d-inline-block mb-2 text-dark">'+chat+'</div>';
            str+='<br />';
            str+='</div>';
            str+='<div class="chat-time d-inline-block text-right text-muted">10:59 am</div>';
        	str+='</li>';
        	$('#chatArea').append(str)
        	
        	var chatCount=$('#chatArea li').length
        	$('#chatArea').scrollTop(chatCount*100)
        	$('div.slimScrollBar').css('top',chatCount*100)
        	
			$('#chatText').val("")
			$('#chatText').focus()
			
		})
	</script>
</body>
</html>